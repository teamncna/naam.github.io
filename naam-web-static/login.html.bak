<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Login â€” NAAM</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>
  <body>
    <main class="container center-content">
      <div class="hero-card">
        <h1>Welcome to NCNA</h1>
        <p class="lead">Please sign in with Google to continue.</p>
        <p class="lead">
          IMPORTANT: If your email not approved in the db as a NCNA member, you
          will not be allowed in. Please contact an admin or Pillayar Nombu
          organizer to get access.
        </p>

        <!-- Google Sign-In Button -->
        <div
          id="g_id_onload"
          data-client_id="677414762046-dnsp2rk6k3bvvhubt0bhimemfrvcei28.apps.googleusercontent.com"
          data-callback="handleGoogleLogin"
          data-auto_prompt="true"
        ></div>
        <div class="g_id_signin" data-type="standard" data-size="large"></div>

        <p id="loginMsg" class="muted small"></p>
      </div>
    </main>

    <script>
      const BACKEND = "https://namma-ooru-backend-q34n.onrender.com";

      async function handleGoogleLogin(response) {
        const msg = document.getElementById("loginMsg");
        msg.textContent = "Verifying your account...";
        try {
          const res = await fetch(`${BACKEND}/web/auth/google`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ token: response.credential }),
          });
          const data = await res.json();

          if (data.ok) {
            localStorage.setItem("userId", data.userId);
            localStorage.setItem("userEmail", data.email);
            localStorage.setItem("userName", data.name);
            msg.textContent = "Login successful! Redirecting...";
            msg.style.color = "var(--green)";
            setTimeout(() => (location.href = "members.html"), 500);
          } else {
            msg.textContent = data.message || "Login failed.";
            msg.style.color = "var(--danger)";
          }
        } catch (err) {
          console.error(err);
          msg.textContent = "Network error logging in.";
          msg.style.color = "var(--danger)";
        }
      }
    </script>
  </body>
</html>
